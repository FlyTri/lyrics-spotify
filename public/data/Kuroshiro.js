HIRAGANA_KATAKANA_SHIFT="ァ".charCodeAt(0)-"ぁ".charCodeAt(0),toKatakana=a=>a.split("").map((a=>a>="぀"&&a<="゗"?String.fromCharCode(a.charCodeAt(0)+HIRAGANA_KATAKANA_SHIFT):a)).join(""),isKana=a=>a>="぀"&&a<="ヿ",hasHiragana=a=>[...a].some((a=>a[0]>="぀"&&a[0]<="ゟ"));const patchTokens=a=>(a.forEach((a=>{hasJapanese(a.surface_form)?a.reading?hasHiragana(a.reading)&&(a.reading=toKatakana(a.reading)):a.reading=isKana(a.surface_form[0])?toKatakana(a.surface_form):a.surface_form:a.reading=a.surface_form})),a.forEach(((r,n)=>{if("助動詞"===r.pos&&["う","ウ"].includes(r.surface_form)&&n>0&&"動詞"===a[n-1].pos){const r=a[n-1];r.surface_form+="う",r.pronunciation=r.pronunciation?r.pronunciation+"ー":`${r.reading}ー`,r.reading+="ウ",a.splice(n,1)}})),a.forEach(((r,n)=>{if((["動詞","形容詞"].includes(r.pos)&&r.surface_form.endsWith("っ")||r.surface_form.endsWith("ッ"))&&n+1<a.length){const e=a[n+1];r.surface_form+=e.surface_form,r.pronunciation=r.pronunciation?r.pronunciation+e.pronunciation:`${r.reading}${e.reading}`,r.reading+=e.reading,a.splice(n+1,1)}})),a);hasJapanese=a=>/[\u3040-\u309f]|[\u30a0-\u30ff]|[\u4e00-\u9fcf]|[\uf900-\ufaff]|[\u3400-\u4dbf]/.test(a),toRawRomaji=a=>{a=a.replace(/(ん|ン)(?=[あいうえおアイウエオぁぃぅぇぉァィゥェォやゆよヤユヨゃゅょャュョ])/g,"$1'");let r="";for(let n=0;n<a.length;n++){const e=a.substring(n,n+2);r+=HEPBURN[e]||HEPBURN[a[n]]||a[n],HEPBURN[e]&&n++}return r.replace(/(っ|ッ)([bcdfghijklmnopqrstuvwyz])/g,"$2$2").replace(/cc/g,"tc").replace(/っ|ッ/g,"tsu").replace(/nm/g,"mm").replace(/nb/g,"mb").replace(/np/g,"mp").replace(/aー/g,"ā").replace(/iー/g,"ī").replace(/uー/g,"ū").replace(/eー/g,"ē").replace(/oー/g,"ō")},kuroshiroConverter=a=>{return(r=a,r.forEach((a=>{hasJapanese(a.surface_form)?a.reading?hasHiragana(a.reading)&&(a.reading=toKatakana(a.reading)):a.reading=isKana(a.surface_form[0])?toKatakana(a.surface_form):a.surface_form:a.reading=a.surface_form})),r.forEach(((a,n)=>{if("助動詞"===a.pos&&["う","ウ"].includes(a.surface_form)&&n>0&&"動詞"===r[n-1].pos){const a=r[n-1];a.surface_form+="う",a.pronunciation=a.pronunciation?a.pronunciation+"ー":`${a.reading}ー`,a.reading+="ウ",r.splice(n,1)}})),r.forEach(((a,n)=>{if((["動詞","形容詞"].includes(a.pos)&&a.surface_form.endsWith("っ")||a.surface_form.endsWith("ッ"))&&n+1<r.length){const e=r[n+1];a.surface_form+=e.surface_form,a.pronunciation=a.pronunciation?a.pronunciation+e.pronunciation:`${a.reading}${e.reading}`,a.reading+=e.reading,r.splice(n+1,1)}})),r).map((a=>toRawRomaji(hasJapanese(a.surface_form)?a.pronunciation||a.reading:a.surface_form))).join(" ");var r};